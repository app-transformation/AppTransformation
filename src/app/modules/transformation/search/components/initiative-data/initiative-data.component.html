<mat-card class="initiative-data">
  <mat-card-title class="initiative-data__header" style="display: flex; align-items: center;">
    <div>
      <p class="initiative-data__title">Initiatives</p>
    </div>
    <span style="margin-left: auto; display: flex; align-items: center;">
      <button mat-raised-button color="primary" (click)="onAddInitiative()" style="margin-right: 8px; display: flex; align-items: center; padding-top: 2px; margin-bottom: 20px; height: 50px; margin-right: 20px">
        <mat-icon style="vertical-align: middle; margin-right: 4px;">add</mat-icon>
        <span style="vertical-align: middle; font-weight: 500;">Add Initiative</span>
      </button>
      <mat-form-field appearance="outline" class="filter-input right-align" style="margin-bottom: 0;">
        <mat-label>Filter</mat-label>
        <input matInput (keyup)="applyFilter($event)" placeholder="Filter results" />
      </mat-form-field>
    </span>
  </mat-card-title>

  <div *ngIf="showAddInitiativeForm" class="add-initiative-form" style="margin: 24px 0; padding: 24px; background: #f7f7f7; border-radius: 8px;">
    <h3>Add New Initiative</h3>
    <form #initiativeForm="ngForm">
      <div style="display: flex; gap: 16px; flex-wrap: wrap;">
        <mat-form-field appearance="fill" style="flex: 1 1 200px;">
          <mat-label>Status</mat-label>
          <input matInput [(ngModel)]="newInitiative.status" name="status" required>
        </mat-form-field>
        <mat-form-field appearance="fill" style="flex: 1 1 200px;">
          <mat-label>Stage</mat-label>
          <input matInput [(ngModel)]="newInitiative.stage" name="stage" required>
        </mat-form-field>
        <mat-form-field appearance="fill" style="flex: 1 1 200px;">
          <mat-label>Owner</mat-label>
          <input matInput [(ngModel)]="newInitiative.owner" name="owner" required>
        </mat-form-field>
        <mat-form-field appearance="fill" style="flex: 1 1 200px;">
          <mat-label>Description</mat-label>
          <input matInput [(ngModel)]="newInitiative.description" name="description">
        </mat-form-field>
        <mat-form-field appearance="fill" style="flex: 1 1 200px;">
          <mat-label>Intended Date</mat-label>
          <input matInput type="date" [(ngModel)]="newInitiative.intendedDate" name="intendedDate">
        </mat-form-field>
        <mat-form-field appearance="fill" style="flex: 1 1 200px;">
          <mat-label>Aspired Date</mat-label>
          <input matInput type="date" [(ngModel)]="newInitiative.aspiredDate" name="aspiredDate">
        </mat-form-field>
      </div>
      <div style="margin-top: 16px;">
        <button mat-raised-button color="primary" (click)="saveInitiative()" [disabled]="!initiativeForm.form.valid">Save</button>
        <button mat-button (click)="showAddInitiativeForm = false" style="margin-left: 8px;">Cancel</button>
      </div>
    </form>
  </div>

  <mat-card-content class="initiative-data__content">
    <table mat-table [dataSource]="dataSource" matSort class="table">

      <!-- Fixed Columns -->
      <ng-container matColumnDef="initiativeId">
        <th class="table-header" mat-header-cell *matHeaderCellDef mat-sort-header>
          <p class="table-header-text">ID</p>
        </th>
        <td class="table-body" mat-cell *matCellDef="let element" (click)="onRowClick(element)" style="cursor:pointer">
          <p class="table-body-text">{{element.initiativeId}}</p>
        </td>
      </ng-container>

      <ng-container matColumnDef="intendedDate">
        <th class="table-header" mat-header-cell *matHeaderCellDef mat-sort-header>
          <p class="table-header-text">Intended Date</p>
        </th>
        <td class="table-body" mat-cell *matCellDef="let element">
          <p class="table-body-text">{{element.intendedDate}}</p>
        </td>
      </ng-container>

      <ng-container matColumnDef="aspiredDate">
        <th class="table-header" mat-header-cell *matHeaderCellDef mat-sort-header>
          <p class="table-header-text">Aspired Date</p>
        </th>
        <td class="table-body" mat-cell *matCellDef="let element">
          <p class="table-body-text">{{element.aspiredDate}}</p>
        </td>
      </ng-container>

      <ng-container matColumnDef="ownerId">
        <th class="table-header" mat-header-cell *matHeaderCellDef mat-sort-header>
          <p class="table-header-text">Owner</p>
        </th>
        <td class="table-body" mat-cell *matCellDef="let element">
          <p class="table-body-text">{{element.ownerId}}</p>
        </td>
      </ng-container>

      <ng-container matColumnDef="stage">
        <th class="table-header" mat-header-cell *matHeaderCellDef mat-sort-header>
          <p class="table-header-text">Stage</p>
        </th>
        <td class="table-body" mat-cell *matCellDef="let element">
          <p class="table-body-text">{{element.stage}}</p>
        </td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th class="table-header" mat-header-cell *matHeaderCellDef mat-sort-header>
          <p class="table-header-text">Status</p>
        </th>
        <td class="table-body" mat-cell *matCellDef="let element">
          <div class="initiative-data__content-badge" [ngClass]="element.status">
            <span>{{element.status}}</span>
          </div>
        </td>
      </ng-container>

      <!-- Dynamic Fields -->
      <ng-container *ngFor="let fieldName of dynamicFieldNames" [matColumnDef]="fieldName">
        <th class="table-header" mat-header-cell *matHeaderCellDef>
          <p class="table-header-text">{{fieldName}}</p>
        </th>
        <td class="table-body" mat-cell *matCellDef="let element">
          <p class="table-body-text">{{ getFieldValue(element.fields, fieldName) }}</p>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" (click)="onRowClick(row)" style="cursor:pointer"></tr>
    </table>
  </mat-card-content>
</mat-card>